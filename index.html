<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading App Sim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        /* Basic styling for active nav item */
        .nav-item.active {
            color: #10B981; /* Emerald-500 */
            border-top: 2px solid #10B981;
        }
        /* Hide sections by default */
        .section {
            display: none;
        }
        /* Show the active section */
        .section.active {
            display: block;
        }
        /* Custom scrollbar for history */
        .history-list::-webkit-scrollbar {
            width: 6px;
        }
        .history-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .history-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .history-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Ensure body takes full height */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif; /* Using Inter font */
        }
        body {
             background-color: #f3f4f6; /* Light gray background */
        }
        /* Main container styling */
        #app-container {
            display: flex;
            flex-direction: column;
            height: 100vh; /* Full viewport height */
            max-width: 480px; /* Max width for mobile view */
            margin: 0 auto; /* Center the container */
            background-color: #ffffff; /* White background for the app area */
            box-shadow: 0 0 10px rgba(0,0,0,0.1); /* Subtle shadow */
        }
        #main-content {
            flex-grow: 1; /* Takes remaining vertical space */
            overflow-y: auto; /* Allows content scrolling */
            padding: 1rem; /* Padding for content */
        }
        #bottom-nav {
            flex-shrink: 0; /* Prevents shrinking */
        }
        /* Button styling */
        .btn {
            @apply py-2 px-4 rounded-lg font-semibold shadow-md transition duration-200 ease-in-out text-sm sm:text-base; /* Adjusted text size */
        }
        .btn-primary { /* Green */
            @apply bg-emerald-500 text-white hover:bg-emerald-600;
        }
        .btn-secondary { /* Gray */
             @apply bg-gray-500 text-white hover:bg-gray-600;
        }
        .btn-red {
            @apply bg-red-500 text-white hover:bg-red-600;
        }
         .btn-violet {
            @apply bg-violet-500 text-white hover:bg-violet-600;
        }
        .btn-blue { /* For Big */
            @apply bg-blue-500 text-white hover:bg-blue-600;
        }
        .btn-yellow { /* For Small */
             @apply bg-yellow-500 text-white hover:bg-yellow-600;
        }
        .btn-number { /* For numbers */
             @apply bg-gray-200 text-gray-800 hover:bg-gray-300 border border-gray-400;
        }
        /* Input styling */
        .input-field {
            @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent;
        }
        /* Message styling */
        .message {
            @apply p-3 rounded-lg mb-4 text-center font-medium text-sm;
        }
        .message-success {
            @apply bg-green-100 text-green-700 border border-green-200;
        }
        .message-error {
            @apply bg-red-100 text-red-700 border border-red-200;
        }
        .message-info {
            @apply bg-blue-100 text-blue-700 border border-blue-200;
        }
         /* Wingo result styling */
        #wingo-result-display {
            border: 2px solid #ccc;
            min-height: 80px; /* Ensure space for result */
        }
         #winning-number-display {
            width: 50px;
            height: 50px;
            line-height: 50px; /* Center text vertically */
         }
    </style>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

</head>
<body>

    <div id="app-container">
        <main id="main-content">
            <div id="deposit-section" class="section">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Deposit Funds</h2>
                <div id="deposit-message" class="message hidden"></div>
                <div class="bg-gray-100 p-4 rounded-lg mb-4 border border-gray-200">
                    <p class="text-gray-700 mb-2">Please pay to the UPI ID below:</p>
                    <p class="text-lg font-semibold text-emerald-600 break-words" id="upi-id">8979873681@mbk</p>
                    <p class="text-sm text-gray-500 mt-1">Minimum Deposit: ₹100</p>
                </div>
                <div class="mb-4">
                    <label for="deposit-amount-upi" class="block text-sm font-medium text-gray-700 mb-1">Amount to Pay</label>
                    <input type="number" id="deposit-amount-upi" class="input-field" placeholder="Enter amount (e.g., 100)">
                </div>
                <button id="pay-button" class="btn btn-primary w-full mb-6">Pay Now via UPI App</button>

                <hr class="my-6 border-gray-300">

                <h3 class="text-xl font-semibold mb-3 text-gray-800">Confirm Deposit</h3>
                <p class="text-sm text-gray-600 mb-4">After successful payment, enter the details below:</p>
                <div class="mb-4">
                    <label for="deposit-amount" class="block text-sm font-medium text-gray-700 mb-1">Amount Deposited</label>
                    <input type="number" id="deposit-amount" class="input-field" placeholder="e.g., 100">
                </div>
                <div class="mb-4">
                    <label for="utr-number" class="block text-sm font-medium text-gray-700 mb-1">UTR Number</label>
                    <input type="text" id="utr-number" class="input-field" placeholder="Enter the 12-digit UTR">
                </div>
                <button id="confirm-deposit-button" class="btn btn-primary w-full">Confirm Deposit</button>
            </div>

            <div id="wallet-section" class="section">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">My Wallet</h2>
                 <div id="wallet-message" class="message hidden"></div>
                <div class="bg-gradient-to-r from-emerald-500 to-green-500 p-6 rounded-xl shadow-lg text-white mb-6">
                    <p class="text-sm uppercase tracking-wider mb-1">Current Balance</p>
                    <p class="text-4xl font-bold">₹<span id="current-balance">0.00</span></p>
                </div>
                 <button id="go-to-deposit-btn" class="btn btn-primary w-full mb-3">Deposit Funds</button>
                 <button id="go-to-withdraw-btn" class="btn btn-secondary w-full">Withdraw Funds</button>
            </div>

            <div id="wingo-section" class="section active">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Wingo Game</h2>
                 <div class="bg-gradient-to-r from-blue-500 to-indigo-500 p-4 rounded-lg shadow-md text-white mb-4 text-center">
                    <p class="text-sm uppercase tracking-wider mb-1">Available Balance</p>
                    <p class="text-2xl font-bold">₹<span id="wingo-balance">0.00</span></p>
                </div>
                <div id="wingo-message" class="message hidden"></div>

                <div class="mb-4">
                    <label for="bet-amount" class="block text-sm font-medium text-gray-700 mb-1">Bet Amount</label>
                    <input type="number" id="bet-amount" class="input-field" placeholder="Enter amount to bet">
                </div>

                <div class="space-y-4 mb-6">
                    <div>
                        <p class="text-sm font-medium text-gray-700 mb-2">Join Color:</p>
                        <div class="grid grid-cols-3 gap-2">
                            <button data-bet-type="Color" data-bet-value="Green" class="wingo-bet-button btn btn-primary">Green</button>
                            <button data-bet-type="Color" data-bet-value="Violet" class="wingo-bet-button btn btn-violet">Violet</button>
                            <button data-bet-type="Color" data-bet-value="Red" class="wingo-bet-button btn btn-red">Red</button>
                        </div>
                    </div>

                    <div>
                         <p class="text-sm font-medium text-gray-700 mb-2">Join Number:</p>
                         <div class="grid grid-cols-5 gap-2">
                             <button data-bet-type="Number" data-bet-value="0" class="wingo-bet-button btn btn-number">0</button>
                             <button data-bet-type="Number" data-bet-value="1" class="wingo-bet-button btn btn-number">1</button>
                             <button data-bet-type="Number" data-bet-value="2" class="wingo-bet-button btn btn-number">2</button>
                             <button data-bet-type="Number" data-bet-value="3" class="wingo-bet-button btn btn-number">3</button>
                             <button data-bet-type="Number" data-bet-value="4" class="wingo-bet-button btn btn-number">4</button>
                             <button data-bet-type="Number" data-bet-value="5" class="wingo-bet-button btn btn-number">5</button>
                             <button data-bet-type="Number" data-bet-value="6" class="wingo-bet-button btn btn-number">6</button>
                             <button data-bet-type="Number" data-bet-value="7" class="wingo-bet-button btn btn-number">7</button>
                             <button data-bet-type="Number" data-bet-value="8" class="wingo-bet-button btn btn-number">8</button>
                             <button data-bet-type="Number" data-bet-value="9" class="wingo-bet-button btn btn-number">9</button>
                         </div>
                    </div>

                    <div>
                         <p class="text-sm font-medium text-gray-700 mb-2">Join Size:</p>
                         <div class="grid grid-cols-2 gap-2">
                             <button data-bet-type="Size" data-bet-value="Big" class="wingo-bet-button btn btn-blue">Big</button>
                             <button data-bet-type="Size" data-bet-value="Small" class="wingo-bet-button btn btn-yellow">Small</button>
                         </div>
                    </div>
                </div>

                <div id="wingo-result-display" class="text-center mt-6 p-4 rounded-lg bg-gray-100 border border-gray-200 hidden">
                    <p class="text-sm font-medium text-gray-600 mb-2">Result:</p>
                    <div class="flex justify-center items-center space-x-3 mb-3">
                        <span id="winning-number-display" class="inline-block text-2xl font-bold rounded-full text-white text-center">?</span>
                        <span id="winning-colors-display" class="text-lg font-semibold"></span>
                        <span id="winning-size-display" class="text-lg font-semibold"></span>
                    </div>
                    <p id="win-loss-message" class="mt-2 text-lg font-bold"></p> </div>
            </div>

            <div id="history-section" class="section">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Transaction History</h2>
                <div id="history-list" class="space-y-3 history-list max-h-[60vh] overflow-y-auto pr-2">
                    <p id="no-history" class="text-gray-500 text-center">No transactions yet.</p>
                </div>
            </div>

            <div id="withdraw-section" class="section">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Withdraw Funds</h2>
                 <button id="back-to-wallet-btn" class="absolute top-4 left-4 text-gray-600 hover:text-gray-800 hidden sm:block"> <i class="fas fa-arrow-left mr-1"></i> Back
                 </button>
                 <button id="back-to-wallet-btn-mobile" class="text-gray-600 hover:text-gray-800 mb-3 sm:hidden"> <i class="fas fa-arrow-left mr-1"></i> Back to Wallet
                 </button>
                <div id="withdraw-message" class="message hidden"></div>
                 <div class="bg-gray-100 p-4 rounded-lg mb-4 border border-gray-200">
                    <p class="text-gray-700">Available Balance: <span class="font-semibold text-emerald-600">₹<span id="withdraw-balance">0.00</span></span></p>
                     <p class="text-sm text-gray-500 mt-1">Minimum Withdrawal: ₹500</p>
                </div>

                <form id="withdraw-form" method="POST">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Amount</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button type="button" data-amount="500" class="withdraw-amount-btn btn bg-gray-200 text-gray-800 hover:bg-emerald-100">₹500</button>
                            <button type="button" data-amount="1000" class="withdraw-amount-btn btn bg-gray-200 text-gray-800 hover:bg-emerald-100">₹1000</button>
                            <button type="button" data-amount="2000" class="withdraw-amount-btn btn bg-gray-200 text-gray-800 hover:bg-emerald-100">₹2000</button>
                            <button type="button" data-amount="5000" class="withdraw-amount-btn btn bg-gray-200 text-gray-800 hover:bg-emerald-100">₹5000</button>
                        </div>
                        <input type="number" id="withdraw-amount" name="amount" class="input-field mt-3" placeholder="Or enter custom amount (min 500)" required>
                    </div>
                    <div class="mb-4">
                        <label for="withdraw-name" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                        <input type="text" id="withdraw-name" name="name" class="input-field" placeholder="Enter your full name" required>
                    </div>
                    <div class="mb-4">
                        <label for="withdraw-upi" class="block text-sm font-medium text-gray-700 mb-1">Your UPI ID</label>
                        <input type="text" id="withdraw-upi" name="upi_id" class="input-field" placeholder="Enter your UPI ID for payment" required>
                    </div>
                    <input type="hidden" id="current-balance-hidden" name="current_balance_before_withdraw">

                    <button type="submit" id="confirm-withdraw-button" class="btn btn-primary w-full">Submit Withdrawal Request</button>
                </form>
            </div>

        </main>

        <nav id="bottom-nav" class="bg-white border-t border-gray-200 shadow-md">
            <div class="max-w-md mx-auto grid grid-cols-4 gap-2 text-center text-gray-600 text-xs py-2">
                <button data-section="deposit-section" class="nav-item pt-1 pb-1 flex flex-col items-center">
                    <i class="fas fa-arrow-down text-lg mb-1"></i> Deposit
                </button>
                <button data-section="wallet-section" class="nav-item pt-1 pb-1 flex flex-col items-center">
                     <i class="fas fa-wallet text-lg mb-1"></i> Wallet
                </button>
                <button data-section="wingo-section" class="nav-item active pt-1 pb-1 flex flex-col items-center"> <i class="fas fa-dice text-lg mb-1"></i> Wingo
                </button>
                <button data-section="history-section" class="nav-item pt-1 pb-1 flex flex-col items-center">
                     <i class="fas fa-history text-lg mb-1"></i> History
                </button>
            </div>
        </nav>
    </div>

    <script>
        // --- Constants ---
        const MIN_DEPOSIT = 100;
        const MIN_WITHDRAWAL = 500;
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/mqaqanbg"; // User Provided Endpoint

        // Wingo Payout Multipliers (Net multiplier: payout - 1)
        const PAYOUTS = {
            COLOR_RED_GREEN: 2, // Bet 100, win 200 (net 100)
            COLOR_VIOLET: 4.5,  // Bet 100, win 450 (net 350)
            NUMBER: 9,          // Bet 100, win 900 (net 800)
            SIZE: 2,            // Bet 100, win 200 (net 100)
            // Special case for Red/Green when Violet hits (0 or 5)
            COLOR_RED_GREEN_WITH_VIOLET: 1.5 // Bet 100, win 150 (net 50)
        };

        // --- DOM Elements ---
        const sections = document.querySelectorAll('.section');
        const navItems = document.querySelectorAll('.nav-item');
        const currentBalanceElement = document.getElementById('current-balance');
        const wingoBalanceElement = document.getElementById('wingo-balance');
        const withdrawBalanceElement = document.getElementById('withdraw-balance');
        const historyListElement = document.getElementById('history-list');
        const noHistoryElement = document.getElementById('no-history');

        // Deposit Elements
        const depositMessage = document.getElementById('deposit-message');
        const depositAmountInput = document.getElementById('deposit-amount');
        const utrInput = document.getElementById('utr-number');
        const confirmDepositButton = document.getElementById('confirm-deposit-button');
        const payButton = document.getElementById('pay-button');
        const depositAmountUpiInput = document.getElementById('deposit-amount-upi');
        const upiIdElement = document.getElementById('upi-id');

        // Wallet Elements
        const walletMessage = document.getElementById('wallet-message');
        const goToDepositBtn = document.getElementById('go-to-deposit-btn');
        const goToWithdrawBtn = document.getElementById('go-to-withdraw-btn');

        // Withdraw Elements
        const withdrawSection = document.getElementById('withdraw-section');
        const withdrawMessage = document.getElementById('withdraw-message');
        const withdrawForm = document.getElementById('withdraw-form');
        const withdrawAmountButtons = document.querySelectorAll('.withdraw-amount-btn');
        const withdrawAmountInput = document.getElementById('withdraw-amount');
        const withdrawNameInput = document.getElementById('withdraw-name');
        const withdrawUpiInput = document.getElementById('withdraw-upi');
        const confirmWithdrawButton = document.getElementById('confirm-withdraw-button');
        const backToWalletBtn = document.getElementById('back-to-wallet-btn');
        const backToWalletBtnMobile = document.getElementById('back-to-wallet-btn-mobile');
        const currentBalanceHiddenInput = document.getElementById('current-balance-hidden');


        // Wingo Elements
        const wingoMessage = document.getElementById('wingo-message');
        const betAmountInput = document.getElementById('bet-amount');
        const wingoBetButtons = document.querySelectorAll('.wingo-bet-button');
        const wingoResultDisplayDiv = document.getElementById('wingo-result-display');
        const winningNumberDisplaySpan = document.getElementById('winning-number-display');
        const winningColorsDisplaySpan = document.getElementById('winning-colors-display');
        const winningSizeDisplaySpan = document.getElementById('winning-size-display');
        const winLossMessageP = document.getElementById('win-loss-message');

        // --- State ---
        let balance = 0;
        let history = []; // Array of { type: 'deposit'/'withdrawal'/'wingo_win'/'wingo_loss', amount: number, timestamp: date, details: string }

        // --- Initialization ---
        function initializeApp() {
            // Load state from localStorage
            balance = parseFloat(localStorage.getItem('balance') || '0');
            history = JSON.parse(localStorage.getItem('history') || '[]');

            // Set Formspree endpoint
            if (!FORMSPREE_ENDPOINT || FORMSPREE_ENDPOINT === "YOUR_FORMSPREE_ENDPOINT_HERE") {
                 console.warn("Formspree endpoint not set correctly. Withdrawals may not work.");
                 // Optionally disable withdraw button or show a warning in withdraw section
                 // We'll handle showing message when user navigates there if needed
                 withdrawForm.action = "#"; // Prevent submission if not set
            } else {
                withdrawForm.action = FORMSPREE_ENDPOINT;
            }

            updateBalanceDisplay();
            renderHistory();
            // Activate the default section (Wingo)
            showSection('wingo-section'); // Default to Wingo as requested
            setupEventListeners();
        }

        // --- State Management ---
        function updateBalance(newBalance) {
            balance = Math.max(0, newBalance); // Ensure balance doesn't go negative
            localStorage.setItem('balance', balance.toFixed(2));
            updateBalanceDisplay();
        }

        function addHistory(type, amount, details = '') {
            const timestamp = new Date();
            // Ensure amount is always positive for history display consistency
            const displayAmount = Math.abs(amount);
            const entry = { type, amount: displayAmount, timestamp: timestamp.toISOString(), details };
            history.unshift(entry); // Add to the beginning
            localStorage.setItem('history', JSON.stringify(history));
            renderHistory();
        }

        // --- UI Updates ---
        function updateBalanceDisplay() {
            const formattedBalance = balance.toFixed(2);
            currentBalanceElement.textContent = formattedBalance;
            wingoBalanceElement.textContent = formattedBalance;
            withdrawBalanceElement.textContent = formattedBalance;
            currentBalanceHiddenInput.value = formattedBalance; // Update hidden input for form
        }

        function renderHistory() {
             historyListElement.innerHTML = ''; // Clear existing list
            if (history.length === 0) {
                noHistoryElement.style.display = 'block';
                return;
            }
            noHistoryElement.style.display = 'none';

            history.forEach(entry => {
                const div = document.createElement('div');
                div.className = 'p-3 rounded-lg border text-sm'; // Smaller text for history
                const date = new Date(entry.timestamp);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`; // Shorter time format
                let detailsText = entry.details ? `<p class="text-xs text-gray-500 mt-1">${entry.details}</p>` : '';
                let amountClass = '';
                let sign = '';
                let typeText = entry.type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()); // Capitalize words

                switch(entry.type) {
                    case 'deposit':
                        div.classList.add('bg-green-50', 'border-green-200');
                        amountClass = 'text-green-600';
                        sign = '+';
                        break;
                    case 'withdrawal':
                        div.classList.add('bg-red-50', 'border-red-200');
                        amountClass = 'text-red-600';
                        sign = '-';
                        break;
                     case 'wingo_win':
                        div.classList.add('bg-blue-50', 'border-blue-200');
                        amountClass = 'text-blue-600';
                        sign = '+';
                        typeText = 'Wingo Win';
                        break;
                    case 'wingo_loss':
                        div.classList.add('bg-orange-50', 'border-orange-200');
                        amountClass = 'text-orange-600';
                        sign = '-';
                         typeText = 'Wingo Loss';
                        break;
                    default:
                         div.classList.add('bg-gray-50', 'border-gray-200');
                         amountClass = 'text-gray-600';
                }

                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">${typeText}</p>
                            <p class="text-xs text-gray-500">${formattedDate}</p>
                        </div>
                        <p class="font-semibold text-base ${amountClass}">${sign}₹${entry.amount.toFixed(2)}</p>
                    </div>
                    ${detailsText}
                `;
                historyListElement.appendChild(div);
            });
        }

        function showSection(sectionId) {
            // Hide all sections
            sections.forEach(section => section.classList.remove('active'));
            // Show the target section
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.add('active');
                // Special handling for withdraw section
                if (sectionId === 'withdraw-section') {
                     document.getElementById('bottom-nav').style.display = 'none'; // Hide nav
                     activeSection.classList.remove('hidden');
                     // Show back buttons
                     backToWalletBtn.classList.remove('hidden');
                     backToWalletBtnMobile.classList.remove('hidden');

                } else {
                    document.getElementById('bottom-nav').style.display = 'block'; // Show nav
                     // Hide back buttons if they exist in other sections (though not currently used)
                     backToWalletBtn.classList.add('hidden');
                     backToWalletBtnMobile.classList.add('hidden');
                    // Update nav item styles
                    navItems.forEach(item => {
                        item.classList.remove('active');
                        if (item.getAttribute('data-section') === sectionId) {
                            item.classList.add('active');
                        }
                    });
                }
            }
             // Scroll to top of content area when switching sections
             document.getElementById('main-content').scrollTop = 0;
             // Hide any persistent messages
             hideMessage('deposit-message');
             hideMessage('wallet-message');
             hideMessage('wingo-message');
             hideMessage('withdraw-message');
             wingoResultDisplayDiv.classList.add('hidden'); // Hide wingo result
        }

        function showMessage(elementId, text, type = 'success') {
            const element = document.getElementById(elementId);
            if (!element) return;
            element.textContent = text;
            element.className = `message message-${type}`; // Reset classes
            element.classList.remove('hidden');
        }

        function hideMessage(elementId) {
             const element = document.getElementById(elementId);
             if (element) {
                element.classList.add('hidden');
                element.textContent = '';
             }
        }

        // --- Event Handlers ---
        function handleNavClick(event) {
            const button = event.target.closest('.nav-item');
            if (button) {
                const sectionId = button.getAttribute('data-section');
                showSection(sectionId);
            }
        }

        function handlePayButtonClick() {
            const amount = parseFloat(depositAmountUpiInput.value);
            const upiId = upiIdElement.textContent;

            if (isNaN(amount) || amount <= 0) {
                 showMessage('deposit-message', 'Please enter a valid amount to pay.', 'error');
                 return;
            }
             hideMessage('deposit-message');
             const upiUrl = `upi://pay?pa=${upiId}&pn=User&am=${amount.toFixed(2)}&cu=INR&tn=Deposit`;
             window.location.href = upiUrl;
             showMessage('deposit-message', 'Attempting to open UPI app. Please complete payment and then confirm below.', 'info');
             depositAmountInput.value = amount.toFixed(2);
        }


        function handleConfirmDeposit() {
            const amount = parseFloat(depositAmountInput.value);
            const utr = utrInput.value.trim();

            hideMessage('deposit-message');

            if (isNaN(amount) || amount < MIN_DEPOSIT) {
                showMessage('deposit-message', `Minimum deposit amount is ₹${MIN_DEPOSIT}.`, 'error');
                return;
            }
            if (!utr || utr.length !== 12 || !/^\d+$/.test(utr)) {
                showMessage('deposit-message', 'Please enter a valid 12-digit UTR number.', 'error');
                return;
            }

            // Add amount to balance
            const newBalance = balance + amount;
            updateBalance(newBalance);
            addHistory('deposit', amount, `UTR: ${utr}`); // Log positive amount for deposit

            showMessage('deposit-message', `Successfully deposited ₹${amount.toFixed(2)}. Your new balance is ₹${balance.toFixed(2)}.`, 'success');

            depositAmountInput.value = '';
            utrInput.value = '';
            depositAmountUpiInput.value = '';
        }

         function handleWithdrawAmountButtonClick(event) {
            const button = event.target.closest('.withdraw-amount-btn');
            if (button) {
                const amount = button.getAttribute('data-amount');
                withdrawAmountInput.value = amount;
                withdrawAmountButtons.forEach(btn => btn.classList.replace('bg-emerald-100', 'bg-gray-200'));
                button.classList.replace('bg-gray-200','bg-emerald-100');
            }
        }

        async function handleWithdrawSubmit(event) {
            event.preventDefault();

            const amount = parseFloat(withdrawAmountInput.value);
            const name = withdrawNameInput.value.trim();
            const upi = withdrawUpiInput.value.trim();

            hideMessage('withdraw-message');

            if (isNaN(amount) || amount < MIN_WITHDRAWAL) {
                showMessage('withdraw-message', `Minimum withdrawal amount is ₹${MIN_WITHDRAWAL}.`, 'error');
                return;
            }
            if (amount > balance) {
                showMessage('withdraw-message', 'Insufficient balance for this withdrawal.', 'error');
                return;
            }
            if (!name || !upi) {
                showMessage('withdraw-message', 'Please enter both name and UPI ID.', 'error');
                return;
            }
             if (!FORMSPREE_ENDPOINT || FORMSPREE_ENDPOINT === "YOUR_FORMSPREE_ENDPOINT_HERE") {
                 showMessage('withdraw-message', 'Withdrawal form not configured by admin.', 'error');
                 return;
             }

            confirmWithdrawButton.disabled = true;
            confirmWithdrawButton.textContent = 'Submitting...';
            confirmWithdrawButton.classList.add('opacity-50');

            const formData = new FormData(withdrawForm);

            try {
                const response = await fetch(FORMSPREE_ENDPOINT, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    const newBalance = balance - amount;
                    updateBalance(newBalance);
                    addHistory('withdrawal', amount, `To: ${name} (${upi})`); // Log positive amount for withdrawal history

                    showMessage('withdraw-message', `Withdrawal request for ₹${amount.toFixed(2)} submitted successfully. Your new balance is ₹${balance.toFixed(2)}.`, 'success');

                    withdrawAmountInput.value = '';
                    withdrawNameInput.value = '';
                    withdrawUpiInput.value = '';
                    withdrawAmountButtons.forEach(btn => btn.classList.replace('bg-emerald-100', 'bg-gray-200'));

                } else {
                     const errorData = await response.json();
                     console.error("Formspree error:", errorData);
                     showMessage('withdraw-message', 'Failed to submit withdrawal request. Please try again.', 'error');
                }
            } catch (error) {
                 console.error("Network or fetch error:", error);
                 showMessage('withdraw-message', 'Network error. Could not submit request.', 'error');
            } finally {
                 confirmWithdrawButton.disabled = false;
                 confirmWithdrawButton.textContent = 'Submit Withdrawal Request';
                 confirmWithdrawButton.classList.remove('opacity-50');
            }
        }

        // --- Wingo Game Logic ---

        // Function to get result properties (color, size) based on number
        function getResultProperties(number) {
            let colors = [];
            let size = '';
            let numberColorClass = 'bg-gray-500'; // Default

            if ([1, 3, 7, 9].includes(number)) {
                colors.push('Green');
                numberColorClass = 'bg-emerald-500';
            }
            if ([2, 4, 6, 8].includes(number)) {
                colors.push('Red');
                 numberColorClass = 'bg-red-500';
            }
            if (number === 0) {
                colors.push('Green', 'Violet');
                 numberColorClass = 'bg-gradient-to-br from-emerald-500 to-violet-500'; // Gradient for 0
            }
            if (number === 5) {
                colors.push('Red', 'Violet');
                numberColorClass = 'bg-gradient-to-br from-red-500 to-violet-500'; // Gradient for 5
            }

            if (number >= 6 && number <= 9) {
                size = 'Big';
            } else if (number >= 1 && number <= 4) {
                size = 'Small';
            } else {
                size = 'N/A'; // 0 and 5 are neither Big nor Small for betting
            }

            return { colors, size, numberColorClass };
        }

        // Main Wingo Bet Handler
        function handleWingoBet(event) {
            const button = event.target.closest('.wingo-bet-button');
            if (!button) return;

            const betType = button.getAttribute('data-bet-type'); // 'Color', 'Number', 'Size'
            const betValue = button.getAttribute('data-bet-value'); // 'Green', '5', 'Big'
            const betAmount = parseFloat(betAmountInput.value);

            hideMessage('wingo-message');
            wingoResultDisplayDiv.classList.add('hidden');

            if (isNaN(betAmount) || betAmount <= 0) {
                showMessage('wingo-message', 'Please enter a valid bet amount.', 'error');
                return;
            }
            if (betAmount > balance) {
                showMessage('wingo-message', 'Insufficient balance to place this bet.', 'error');
                return;
            }

            // --- Simulate Game Result ---
            const winningNumber = Math.floor(Math.random() * 10); // 0-9
            const resultProps = getResultProperties(winningNumber);

            let netWinAmount = 0; // Amount won/lost (positive for win, negative for loss)
            let message = '';
            let messageType = 'error'; // Default to loss message
            let historyType = 'wingo_loss';

            // --- Determine Win/Loss and Payout ---
            switch (betType) {
                case 'Color':
                    if (resultProps.colors.includes(betValue)) { // Check if the bet color is in the result colors
                        if (betValue === 'Violet') {
                            netWinAmount = betAmount * (PAYOUTS.COLOR_VIOLET - 1);
                        } else { // Red or Green bet
                            if (resultProps.colors.includes('Violet')) { // Violet also hit (0 or 5)
                                netWinAmount = betAmount * (PAYOUTS.COLOR_RED_GREEN_WITH_VIOLET - 1);
                            } else { // Normal Red/Green win
                                netWinAmount = betAmount * (PAYOUTS.COLOR_RED_GREEN - 1);
                            }
                        }
                    } else {
                        netWinAmount = -betAmount; // Loss
                    }
                    break;

                case 'Number':
                    if (parseInt(betValue) === winningNumber) {
                        netWinAmount = betAmount * (PAYOUTS.NUMBER - 1);
                    } else {
                        netWinAmount = -betAmount; // Loss
                    }
                    break;

                case 'Size':
                    if (betValue === resultProps.size) { // Win only if size matches and is not N/A
                         netWinAmount = betAmount * (PAYOUTS.SIZE - 1);
                    } else {
                         netWinAmount = -betAmount; // Loss (includes 0 and 5 results)
                    }
                    break;
            }

            // --- Update Balance and History ---
            const newBalance = balance + netWinAmount;
            updateBalance(newBalance);

            // --- Prepare Display Message and History ---
            const betDetail = `Bet: ₹${betAmount.toFixed(2)} on ${betType} ${betValue}. Result: ${winningNumber} (${resultProps.colors.join('/')}${resultProps.size !== 'N/A' ? '/' + resultProps.size : ''})`;

            if (netWinAmount > 0) {
                message = `You Won ₹${netWinAmount.toFixed(2)}!`;
                messageType = 'success';
                historyType = 'wingo_win';
                 addHistory(historyType, netWinAmount, betDetail); // Log net win amount
            } else {
                message = `You Lost ₹${betAmount.toFixed(2)}`; // Show the amount betted as loss
                messageType = 'error';
                historyType = 'wingo_loss';
                 addHistory(historyType, betAmount, betDetail); // Log bet amount as loss amount
            }

            // --- Display Result ---
            winningNumberDisplaySpan.textContent = winningNumber;
            winningNumberDisplaySpan.className = `inline-block text-2xl font-bold rounded-full text-white text-center ${resultProps.numberColorClass}`; // Apply color class
             winningNumberDisplaySpan.style.width = '50px'; // Ensure consistent size
             winningNumberDisplaySpan.style.height = '50px';
             winningNumberDisplaySpan.style.lineHeight = '50px';

            winningColorsDisplaySpan.textContent = resultProps.colors.join(' / ');
             // Color the text based on primary color (or Violet if present)
             if (resultProps.colors.includes('Violet')) winningColorsDisplaySpan.className = 'text-lg font-semibold text-violet-600';
             else if (resultProps.colors.includes('Green')) winningColorsDisplaySpan.className = 'text-lg font-semibold text-emerald-600';
             else if (resultProps.colors.includes('Red')) winningColorsDisplaySpan.className = 'text-lg font-semibold text-red-600';
             else winningColorsDisplaySpan.className = 'text-lg font-semibold text-gray-600';


            winningSizeDisplaySpan.textContent = resultProps.size !== 'N/A' ? resultProps.size : '';
             if (resultProps.size === 'Big') winningSizeDisplaySpan.className = 'text-lg font-semibold text-blue-600';
             else if (resultProps.size === 'Small') winningSizeDisplaySpan.className = 'text-lg font-semibold text-yellow-600';
             else winningSizeDisplaySpan.className = 'text-lg font-semibold text-gray-600';


            winLossMessageP.textContent = message;
            winLossMessageP.className = `mt-2 text-lg font-bold ${messageType === 'success' ? 'text-green-600' : 'text-red-600'}`;
            wingoResultDisplayDiv.classList.remove('hidden');

            // Clear bet amount
            betAmountInput.value = '';
        }


        // --- Setup Event Listeners ---
        function setupEventListeners() {
            // Navigation
            navItems.forEach(item => item.addEventListener('click', handleNavClick));

            // Deposit
            confirmDepositButton.addEventListener('click', handleConfirmDeposit);
            payButton.addEventListener('click', handlePayButtonClick);


            // Wallet Buttons
            goToDepositBtn.addEventListener('click', () => showSection('deposit-section'));
            goToWithdrawBtn.addEventListener('click', () => showSection('withdraw-section'));

             // Withdraw
             withdrawForm.addEventListener('submit', handleWithdrawSubmit);
             withdrawAmountButtons.forEach(button => button.addEventListener('click', handleWithdrawAmountButtonClick));
             backToWalletBtn.addEventListener('click', () => showSection('wallet-section'));
             backToWalletBtnMobile.addEventListener('click', () => showSection('wallet-section'));


            // Wingo
            wingoBetButtons.forEach(button => button.addEventListener('click', handleWingoBet));
        }

        // --- Start the App ---
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>

</body>
</html>
